<html lang="en" data-lt-installed="true" class="gr__getbootstrap_com">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Document Cards</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
        crossorigin="anonymous">
    
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqcloud/1.0.4/jqcloud.css">
<style>
#circle {
    display: none;
    width: 100%;
    height: 100%;
    position: fixed;
    z-index: 10;
    background: black;
    opacity: 0.7;
    text-align: center;
}
</style>

<body>
    <div id="circle">
        <img src="source.gif" style="
            margin-top: 5%;
            height: 80%;
        ">
    </div>

        <!-- Just an image -->
        <nav class="navbar navbar-dark bg-dark justify-content-between">
            <a class="navbar-brand" href="#">
                Document Cards
            </a>
                             
            <div class="form-inline mb-0">
                <input id="search_text" class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
                <button  class="btn btn-outline-info my-2 my-sm-0" onclick="search_documents()" type="button">Search</button>
            </div>

        </nav>


    <main role="main">
        <div class="album py-5 bg-light">
            <div class="container">
                <div class="row" class="mb-5">
                    <div class="col-3">
                        <form id="upload_file" method="POST" class="custom-file">
                            <input class="mb-1" type="file" name="file" accept="application/pdf"  id="customFile">                            
                            <input class="btn btn-success" type="submit" value="Upload File">                                                                                  
                        </form> 
                        <br/>                                                     
                        <br/>                                                     
                    </div>
                    <hr class="col-12">
                </div>
                <div id="documents" class="row">
                    
                </div>
            </div>
        </div>

    </main>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://code.jquery.com/jquery-3.1.1.min.js" ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqcloud/1.0.4/jqcloud-1.0.4.min.js" crossorigin="anonymous"></script>
    <script>        
        var url_endpoint = 'http://127.0.0.1:5000/';
        load_page("");
        function search_documents(){
            var query = $("#search_text").val();
            $( "#circle" ).toggle();
            load_page(query);
            $( "#circle" ).toggle();
        }
        function load_page(query){
            $( "#circle" ).toggle();
            $('#documents').empty();
            $.get(url_endpoint + "getdocuments/" + query, function (data, status) {                
                for (var i = 0; i < data.length; i++) {
                    var doc = data[i];
                    doc["words"] = [];
                    var word_dist = data[i]["word_dist"];
                    for (var j = 0; j < word_dist.length; j++) {
                        var new_word_dist = {};
                        new_word_dist["text"] = word_dist[j][0];
                        new_word_dist["weight"] = word_dist[j][1];
                        doc["words"].push(new_word_dist);
                    }
                    var word_cloud = '<div id="document-words-' + doc.id + '" style="width: 100%; height: 300px;"></div>';
                    var template = '<div class="col-md-4"><div class="card mb-4 box-shadow"><div class="card-body"><h5 class="card-title">' + doc.name + '</h5><p class="card-text">' + word_cloud + '<small class="text-muted">' + doc.information[0]['/Author'] + '</small></p><div class="d-flex justify-content-between align-items-center">';
                    template += '<div class="btn-group"><a type="button" class="btn btn-success" href="preview.html?id=' + doc.id + '">View</a></div></div></div></div></div>';
                    $('#documents').append(template);
                    
                    $("#document-words-" + doc.id).jQCloud(doc["words"],
                        {
                            shape: "rectangular",
                            autoResize: true
                        });
                    
                }
                $( "#circle" ).toggle();
            });
        }
        
        // $.get(url_endpoint + "return-file", function(data, status) {
        //     console.error(data);            
        // })

        $("#upload_file").on('submit', (function (e) {
            e.preventDefault();
            $( "#circle" ).toggle();
            $.ajax({
                    url: "http://127.0.0.1:5000/fileupload",
                    type: "POST",
                    data: new FormData(this),
                    contentType: false,
                    cache: false,
                    processData: false,
                    beforeSend: function () {
                        //$("#preview").fadeOut();
                        $("#err").fadeOut();
                    },
                    success: function (data) {
                        console.error(data);
                        load_page("");    
                        $( "#circle" ).toggle();                    
                    },
                    error: function (e) {
                        console.error(e);
                        $( "#circle" ).toggle();
                    }
                });
        }));
    </script>

</body>

</html>